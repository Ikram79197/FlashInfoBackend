import{r as j,j as e,a as V}from"./react-DHBI0EtI.js";import{c as Y}from"./react-dom-CAvYKTQr.js";import{F as k,A as W,B as R,S as q,I as L,C as D,a as E,L as G,D as H,M as K,P as J}from"./antd-Cvo0_FjW.js";import{p as Z,q as Q,l as X,m as ee,r as te,s as se,d as ne,t as ie,u as re,v as oe}from"./@ant-design/icons-CeGu2I2N.js";import"./classnames-C9FZUsQl.js";import"./scheduler-DYLXRpC5.js";import"./rc-util-DJfO4RUt.js";import"./@babel/runtime-bjg2LrFx.js";import"./react-is-DcAOwtUU.js";import"./@ant-design/cssinjs-DsNH0EtS.js";import"./@emotion/hash-WldOFDRm.js";import"./@emotion/unitless-BWzHn38B.js";import"./stylis-D5iaQeiq.js";import"./@ant-design/cssinjs-utils-B3P3BheD.js";import"./rc-resize-observer-CmbOIhQg.js";import"./resize-observer-polyfill-B1PUzC5B.js";import"./rc-motion-vb8LhtBE.js";import"./rc-overflow-CRXJGAbk.js";import"./rc-menu-Cw7Ycfbe.js";import"./@rc-component/trigger-DicWPVQE.js";import"./@rc-component/portal-C1fNsaKg.js";import"./@ant-design/fast-color-DQS9xAp9.js";import"./rc-tabs-B2yJ8VQt.js";import"./rc-dropdown-Cesj57_c.js";import"./rc-checkbox-DG31C70D.js";import"./@rc-component/color-picker-Dpc1bpkh.js";import"./rc-drawer-BFp7xCAY.js";import"./rc-field-form-T6jA2d-z.js";import"./@rc-component/async-validator-B_KGBgLV.js";import"./scroll-into-view-if-needed-Bq0bK-M8.js";import"./compute-scroll-into-view-Bl8rNFhg.js";import"./rc-input-CxgsJPNJ.js";import"./rc-textarea-DKYRL79Z.js";import"./rc-pagination-CLBq3R4W.js";import"./rc-picker-BIf95Ow_.js";import"./@ant-design/colors-Dib51zE1.js";import"./rc-progress-BIZpZzv6.js";import"./rc-tooltip-CCN_d8jH.js";import"./@ant-design/icons-svg-COzDYt5I.js";(function(){const l=document.createElement("link").relList;if(l&&l.supports&&l.supports("modulepreload"))return;for(const s of document.querySelectorAll('link[rel="modulepreload"]'))b(s);new MutationObserver(s=>{for(const h of s)if(h.type==="childList")for(const S of h.addedNodes)S.tagName==="LINK"&&S.rel==="modulepreload"&&b(S)}).observe(document,{childList:!0,subtree:!0});function m(s){const h={};return s.integrity&&(h.integrity=s.integrity),s.referrerPolicy&&(h.referrerPolicy=s.referrerPolicy),s.crossOrigin==="use-credentials"?h.credentials="include":s.crossOrigin==="anonymous"?h.credentials="omit":h.credentials="same-origin",h}function b(s){if(s.ep)return;s.ep=!0;const h=m(s);fetch(s.href,h)}})();const P="https://flashinfo.mamda-mcma.ma/flashInfo/api";function F({url:c,data:l,method:m="GET",headers:b={},timeout:s=1e4}){const h={"Content-Type":"application/json",Accept:"application/json",...b};if(!(c&&c.includes("/public/otp")))try{const a=localStorage.getItem("flashinfo_token");a&&typeof a=="string"&&a.split(".").length===3?h.Authorization=`Bearer ${a}`:a&&localStorage.removeItem("flashinfo_token")}catch{}const w={method:m,headers:h,signal:AbortSignal.timeout(s)};return l&&(m==="POST"||m==="PUT"||m==="PATCH")&&(w.body=JSON.stringify(l)),fetch(c,w).then(async a=>{if(!a.ok){const x=await a.text().catch(()=>"")||a.statusText,N=new Error(`Erreur HTTP: ${a.status} - ${x}`);throw N.status=a.status,N.body=x,N}return a.status===204?null:(a.headers.get("content-type")||"").includes("application/json")?await a.json():await a.text()}).catch(a=>{if(a.name==="AbortError"){const _=new Error("Timeout: La requête a pris trop de temps");throw _.name="AbortError",_}throw a})}function le(){return F({url:P+"/chiffre-affaires",method:"GET"})}function O(){return F({url:P+"/ca-non-vie-this-month",method:"GET"})}function ae(c,l){return F({url:P+"/login",method:"POST",data:{username:c,password:l}})}function ce(c,l){return F({url:P+"/public/otp",method:"POST",data:{userLogin:c,systemName:"FlashInfo",codeValue:l}})}function de(c,l){return F({url:P+"/users/updatePassword",method:"POST",data:{userLogin:c,newPassword:l}})}const ue=({onVerify:c,onBack:l,email:m,phone:b,loading:s,error:h})=>{const[S]=k.useForm(),[w,a]=j.useState(""),[_,z]=j.useState(0),x=j.useRef([]);j.useEffect(()=>{let y;return _>0&&(y=setInterval(()=>{z(o=>o-1)},1e3)),()=>clearInterval(y)},[_]);const N=(y,o)=>{var t;const d=y.replace(/[^0-9]/g,"");d.length>1||(x.current[o]&&(x.current[o].value=d),d&&o<5&&((t=x.current[o+1])==null||t.focus()))},v=(y,o)=>{var d,t,n;y.key==="Backspace"&&!y.target.value&&o>0&&((d=x.current[o-1])==null||d.focus()),y.key==="ArrowLeft"&&o>0&&((t=x.current[o-1])==null||t.focus()),y.key==="ArrowRight"&&o<5&&((n=x.current[o+1])==null||n.focus())},u=async()=>{a("");const y=x.current.map(o=>o?o.value:"").join("");if(y.length!==6){a("");return}await c(y)},I=async()=>{var y;setError(""),a("");try{await new Promise(o=>setTimeout(o,500)),z(60),x.current.forEach(o=>{o&&(o.value="")}),(y=x.current[0])==null||y.focus()}catch(o){setError((o==null?void 0:o.message)||"Erreur lors du renvoi du code.")}};return e.jsx("div",{className:"otp-verification-container",children:e.jsxs("div",{className:"otp-card",children:[e.jsxs("div",{className:"otp-left-section",children:[e.jsx("div",{className:"otp-gradient-background"}),e.jsx("div",{className:"otp-particles-effect"}),e.jsx("div",{className:"otp-left-content",children:e.jsxs("div",{className:"otp-left-inner",children:[e.jsx("div",{className:"otp-icon-container",children:e.jsx("div",{className:"otp-icon",children:e.jsxs("svg",{width:"120",height:"120",viewBox:"0 0 120 120",fill:"none",children:[e.jsx("circle",{cx:"60",cy:"60",r:"55",stroke:"#951b81",strokeWidth:"2",opacity:"0.2"}),e.jsx("path",{d:"M50 60L55 65L70 50",stroke:"#951b81",strokeWidth:"3",fill:"none",strokeLinecap:"round",strokeLinejoin:"round"})]})})}),e.jsx("h2",{className:"otp-title",children:"Sécurité en place"}),e.jsx("p",{className:"otp-description",children:"Votre compte est protégé par une vérification en deux étapes. Veuillez entrer le code envoyé."}),e.jsxs("div",{className:"otp-features",children:[e.jsxs("div",{className:"otp-feature",children:[e.jsx("span",{className:"feature-icon",children:"✓"}),e.jsx("span",{children:"Vérification SMS"})]}),e.jsxs("div",{className:"otp-feature",children:[e.jsx("span",{className:"feature-icon",children:"✓"}),e.jsx("span",{children:"Vérification Email"})]}),e.jsxs("div",{className:"otp-feature",children:[e.jsx("span",{className:"feature-icon",children:"✓"}),e.jsx("span",{children:"Code à usage unique"})]})]})]})})]}),e.jsx("div",{className:"otp-right-section",children:e.jsxs("div",{className:"otp-form-container",children:[e.jsxs("button",{className:"otp-back-button",onClick:l,disabled:s,children:[e.jsx(Z,{}),e.jsx("span",{children:"Retour"})]}),e.jsxs("div",{className:"otp-header-section",children:[e.jsx("h2",{className:"otp-welcome-title",children:"Vérification en deux étapes"}),e.jsx("p",{className:"otp-subtitle",children:"Entrez le code à 6 chiffres envoyé à:"})]}),h&&e.jsx(W,{message:h,type:"error",showIcon:!0,style:{marginBottom:"24px"},closable:!0}),w&&e.jsx(W,{message:w,type:"success",showIcon:!0,style:{marginBottom:"24px"},closable:!0,onClose:()=>a("")}),e.jsxs("div",{className:"otp-form-section",children:[e.jsx("label",{className:"otp-label",children:"Code de vérification"}),e.jsx("div",{className:"otp-input-group",children:Array.from({length:6}).map((y,o)=>e.jsx("input",{ref:d=>x.current[o]=d,type:"text",maxLength:"1",className:"otp-input",placeholder:"0",onChange:d=>N(d.target.value,o),onKeyDown:d=>v(d,o),disabled:s,autoFocus:o===0},o))}),e.jsx("p",{className:"otp-hint",children:"Entrez les 6 chiffres du code reçu"})]}),e.jsx(R,{type:"primary",block:!0,size:"large",onClick:u,loading:s,className:"otp-submit-button",disabled:s,style:{marginTop:"32px"},children:s?"Vérification...":"Vérifier le code"}),e.jsxs("div",{className:"otp-resend-section",children:[e.jsx("p",{className:"otp-resend-text",children:"Vous n'avez pas reçu le code ?"}),e.jsx(q,{direction:"vertical",style:{width:"100%"},children:e.jsx(R,{type:"link",onClick:I,disabled:_>0||s,className:"otp-resend-button",children:_>0?`Renvoyer le code (${_}s)`:"Renvoyer le code"})})]}),e.jsx("div",{className:"otp-timer-info",children:e.jsxs("p",{className:"otp-timer-text",children:[e.jsx("span",{className:"timer-icon",children:"⏱"}),"Code valide pendant 3 minutes"]})})]})})]})})},$="/assets/MamdaMcma_Logo%20instit-BC1jT0T5.png",me="/assets/coin-DihKcplc.png",he=({onLogin:c})=>{const[l]=k.useForm(),[m,b]=j.useState(!1),[s,h]=j.useState(""),[S,w]=j.useState(!1),[a,_]=j.useState({username:"",email:"",phone:""}),z=async v=>{b(!0),h("");try{const u=v&&v.username||"",I=v&&v.password||"",y=await ae(u,I),o=y,d=(o==null?void 0:o.token)||(o==null?void 0:o.accessToken)||(o==null?void 0:o.jwt),t=o==null?void 0:o.username;if(console.log("response login ",y),console.log("Login successful for user:",t),localStorage.setItem("flashinfo_userLogin",t),localStorage.setItem("flashinfo_username",u),!d){w(!0),_({username:t,phone:o.phone});return}const n=String(d),i=n.startsWith("Bearer ")?n.substring(7):n;if(!i||!i.includes("."))throw new Error("Token invalide reçu du serveur");localStorage.setItem("flashinfo_token",i),c(i)}catch(u){let I;u&&(u.status===401||u.status===403)?I="Mail ou mot de passe incorrect":I=(u==null?void 0:u.body)||(u==null?void 0:u.message)||"Erreur lors de la connexion",h(I)}finally{b(!1)}},x=async v=>{try{const u=await ce(a.username,v);let I=(u==null?void 0:u.token)||(u==null?void 0:u.accessToken)||(u==null?void 0:u.jwt);const y=(u==null?void 0:u.password_changed)||(u==null?void 0:u.passwordChanged);if(!I)throw new Error("Token JWT non reçu après OTP");localStorage.setItem("flashinfo_token",I),a.username&&(localStorage.setItem("flashinfo_userLogin",a.username),localStorage.setItem("flashinfo_username",a.username)),w(!1),c(I,y)}catch{}finally{b(!1)}},N=()=>{};return S?e.jsx(ue,{onVerify:x,onBack:()=>w(!1),phone:a.phone,loading:m,error:s}):e.jsx("div",{className:"login-container",children:e.jsxs("div",{className:"login-card",children:[e.jsxs("div",{className:"left-section",children:[e.jsx("div",{className:"gradient-background"}),e.jsx("div",{className:"particles-effect"}),e.jsx("div",{className:"left-content",children:e.jsxs("div",{className:"left-inner",children:[e.jsxs("div",{className:"graph-container",children:[e.jsx("img",{src:me,alt:"Illustration financière avec graphiques et visualisations de données",className:"graph-image"}),e.jsx("div",{className:"graph-overlay"})]}),e.jsxs("h1",{className:"main-title",children:[e.jsx("span",{className:"title-gradient",children:"FlashInfo"}),e.jsx("br",{}),e.jsx("span",{className:"title-subtitle",children:"Dashboard"})]}),e.jsx("p",{className:"description",children:"Accédez instantanément à vos informations critiques et pilotez vos données en temps réel avec FlashInfo."}),e.jsxs("div",{className:"decorative-bars",children:[e.jsx("div",{className:"bar-1"}),e.jsx("div",{className:"bar-2"}),e.jsx("div",{className:"bar-3"})]}),e.jsx("div",{className:"info-card",children:e.jsx("div",{className:"info-row",children:e.jsx("span",{className:"info-value",children:"MAMDA • MCMA"})})})]})})]}),e.jsx("div",{className:"right-section",children:e.jsxs("div",{className:"form-container",children:[e.jsxs("div",{className:"header-section",children:[e.jsx("img",{src:$,alt:"Logo MamdaMcma",className:"logo"}),e.jsx("h2",{className:"welcome-title",children:e.jsx("span",{className:"welcome-gradient",children:"Bienvenue"})}),e.jsx("p",{className:"subtitle",children:"Connectez-vous à votre tableau de bord FlashInfo."})]}),s&&e.jsx(W,{message:s,type:"error",showIcon:!0,style:{marginBottom:"24px"},closable:!0,onClose:()=>h("")}),e.jsx("div",{className:"form-section",children:e.jsxs(k,{form:l,name:"login",onFinish:z,onFinishFailed:N,layout:"vertical",size:"large",className:"custom-form",children:[e.jsx(k.Item,{name:"username",label:"Email",rules:[],children:e.jsx(L,{prefix:e.jsx(Q,{style:{color:"#951b81"}}),placeholder:"votre_nom_utilisateur (optionnel)",className:"custom-input"})}),e.jsx(k.Item,{name:"password",label:"Mot de passe",rules:[],children:e.jsx(L.Password,{prefix:e.jsx(te,{style:{color:"#951b81"}}),placeholder:"•••••••• (optionnel)",iconRender:v=>v?e.jsx(X,{style:{color:"#951b81"}}):e.jsx(ee,{style:{color:"#951b81"}}),className:"custom-input"})}),e.jsxs("div",{className:"checkbox-section",children:[e.jsx(k.Item,{name:"remember",valuePropName:"checked",noStyle:!0,children:e.jsx(D,{className:"custom-checkbox",children:"Se souvenir de moi"})}),e.jsx("a",{href:"#",className:"forgot-link",children:"Mot de passe oublié ?"})]}),e.jsx(k.Item,{style:{marginTop:"24px"},children:e.jsx(R,{type:"primary",htmlType:"submit",loading:m,className:"custom-button",children:m?"Connexion...":"Se connecter"})})]})})]})})]})})};function p(c){if(c==null||c==="")return"0";if(typeof c=="number")return Math.round(c).toLocaleString("fr-FR").replace(/\u202F|\u00A0|,/g," ");let l=String(c).trim();l=l.replace(/\u00A0|\u202F/g," "),l=l.replace(/%/g,"").trim();const m=l.match(/^(.*)\s(\d{2})$/);if(m){const h=m[1],S=m[2],w=h.replace(/[^0-9]/g,""),a=parseFloat(w+"."+S);if(!isNaN(a))return Math.round(a).toLocaleString("fr-FR").replace(/\u202F|\u00A0|,/g," ")}if(/[.,]/.test(l)){const h=l.lastIndexOf(","),S=l.lastIndexOf("."),w=Math.max(h,S);if(w>-1){const a=l.slice(0,w),_=l.slice(w+1);if(!/\s|[.,]/.test(_)){const z=a.replace(/[^0-9]/g,""),x=_.replace(/[^0-9]/g,""),N=z+(x?"."+x:""),v=parseFloat(N);if(!isNaN(v))return Math.round(v).toLocaleString("fr-FR").replace(/\u202F|\u00A0|,/g," ")}}}const b=l.replace(/[^0-9]/g,"");if(!b)return"0";const s=parseFloat(b);return isNaN(s)?"0":Math.round(s).toLocaleString("fr-FR").replace(/\u202F|\u00A0|,/g," ")}function f(c,l=2){if(c==null||c==="")return"0,00 %";const m=typeof c=="string"?parseFloat(c.toString().replace(/\s/g,"").replace(",",".").replace("%","")):Number(c);return isNaN(m)?"0,00 %":m.toFixed(l).replace(".",",")+" %"}const fe="/assets/ca-global-icon-BCjgHapJ.png",pe="/assets/iconNONvie-DJft6t8b.png",xe="/assets/iconVie-ZFrT48Kt.png",ge="/assets/icon-cam-1-DeExYDUX.png";function M(c){if(!c)return{fontWeight:700,borderRadius:4,padding:"1px 6px",whiteSpace:"nowrap"};const l=c.toString().replace("%","").replace(",",".").trim(),m=parseFloat(l);return isNaN(m)?{fontWeight:700,borderRadius:4,padding:"1px 6px",whiteSpace:"nowrap"}:m<0?{background:"#ef4444",color:"#fff",fontWeight:700,borderRadius:4,padding:"1px 6px",whiteSpace:"nowrap"}:m<5?{background:"#fb923c",color:"#fff",fontWeight:700,borderRadius:4,padding:"1px 6px",whiteSpace:"nowrap"}:m>=100?{background:"#15803d",color:"#fff",fontWeight:700,borderRadius:4,padding:"1px 6px",whiteSpace:"nowrap"}:{background:"#22c55e",color:"#fff",fontWeight:700,borderRadius:4,padding:"1px 6px",whiteSpace:"nowrap"}}function A(c){if(!c)return{color:"#64748b",fontWeight:700};const l=c.toString().replace("%","").replace(",",".").trim(),m=parseFloat(l);return isNaN(m)?{color:"#64748b",fontWeight:700}:m<0?{color:"#ef4444",fontWeight:700}:m<5?{color:"#fb923c",fontWeight:700}:m>=100?{color:"#15803d",fontWeight:700}:{color:"#22c55e",fontWeight:700}}function je(){const[c,l]=j.useState(null),[m,b]=j.useState([]),[s,h]=j.useState(!0),[S,w]=j.useState(null),[a,_]=j.useState([]),[z,x]=j.useState(!0);j.useEffect(()=>{const g=async()=>{try{h(!0);const C=await le();b(C),w(null)}catch(C){console.error("Erreur lors du chargement des données:",C),w(C.message),b([])}finally{h(!1)}},r=async()=>{try{x(!0);const C=await O();_(Array.isArray(C)?C:[])}catch{_([])}finally{x(!1)}};g(),r()},[O]);const N=()=>{const g=new Date;return g.setDate(g.getDate()-1),g.toLocaleDateString("fr-FR")},v=()=>{const g=["janvier","février","mars","avril","mai","juin","juillet","août","septembre","octobre","novembre","décembre"],r=new Date;return r.setDate(r.getDate()-1),g[r.getMonth()]},u=()=>{const g=["janvier","février","mars","avril","mai","juin","juillet","août","septembre","octobre","novembre","décembre"],r=new Date;r.setDate(r.getDate()-1);let C=r.getMonth()-1;return C<0&&(C=11),g[C]},I=()=>{const g=new Date;g.setDate(g.getDate()-1);let r=g.getMonth()-1,C=g.getFullYear();return r<0&&(C=C-1),C},y=()=>new Date().getFullYear()-1,o=()=>new Date().getFullYear();`${N()}`,v().charAt(0).toUpperCase()+v().slice(1),`${N()}`,v().charAt(0).toUpperCase()+v().slice(1),`${y()}`,`${o()}`,`${u()}${I()}`,`${u()}${I()}`;const d=g=>m.find(r=>r.key===g),t=d("non-vie"),n=d("vie"),i=d("total");return e.jsxs("div",{style:{background:"#f8fafc",minHeight:"100vh",padding:"16px",maxWidth:"100vw",boxSizing:"border-box"},children:["            ",e.jsxs("div",{style:{textAlign:"center",marginBottom:16},children:[e.jsx("img",{src:$,alt:"MamdaMcma Logo",style:{height:"80px",width:"auto",maxWidth:"220px",objectFit:"contain",display:"block",margin:"0 auto 8px"}}),e.jsx("div",{style:{fontSize:28,fontWeight:700,color:"#3A3163",marginBottom:8},children:"Flash Info"}),e.jsxs("div",{style:{fontSize:18,color:"#64748b",marginBottom:8},children:["du ",N()]}),e.jsx("div",{style:{height:2,background:"linear-gradient(90deg, #1677ff 0%, #f472b6 100%)",margin:"0 auto 24px",width:320}})]}),e.jsxs("div",{style:{display:"flex",justifyContent:"center",alignItems:"flex-start",flexWrap:"wrap",gap:24,marginTop:16,width:"100%"},children:[e.jsxs(E,{className:"ca-global-card",styles:{body:{padding:24,background:"#D9D9D9",cursor:"pointer"},header:{background:"#253338",borderRadius:"12px 12px 0 0",padding:0}},style:{borderRadius:12,boxShadow:"0 2px 8px #e5e7eb",border:"1px solid #e5e7eb",minWidth:260,maxWidth:320,flex:1,width:"100%",background:"#D9D9D9"},title:e.jsx("div",{style:{display:"flex",flexDirection:"column",alignItems:"center",gap:2,width:"100%"},children:e.jsxs("span",{style:{fontSize:22,color:"#fff",fontWeight:700,display:"flex",alignItems:"center",gap:8,justifyContent:"center"},children:[e.jsx("img",{src:fe,alt:"CA Global Icon",style:{width:28,height:28,objectFit:"contain",verticalAlign:"middle"}})," CA Global"]})}),onClick:()=>l(c==="total"?null:"total"),children:[e.jsxs("div",{style:{marginBottom:16},children:[e.jsxs("div",{style:{fontSize:13,color:"#3A3163",fontWeight:500},children:["CA du jour ",N()]}),e.jsx("div",{style:{fontSize:22,fontWeight:700,color:"#000000"},children:s?"Chargement...":(i==null?void 0:i.ca_du_jour)!=null?p(i.ca_du_jour):p(0)})]}),e.jsxs("div",{style:{marginBottom:16,display:"flex",alignItems:"center",justifyContent:"space-between",gap:16},children:[e.jsxs("div",{children:[e.jsx("div",{style:{fontSize:13,color:"#3A3163",fontWeight:500},children:" MTD  "}),e.jsx("div",{style:{fontSize:20,fontWeight:700,color:"#000000"},children:s?"Chargement...":(i==null?void 0:i.ca_mois_actuel)!=null?p(i.ca_mois_actuel):p(0)})]}),e.jsxs("div",{style:{textAlign:"right"},children:[e.jsx("div",{style:{fontSize:13,color:"#3A3163",fontWeight:500},children:"Taux de remplissage"}),e.jsx("span",{style:{...M((i==null?void 0:i.taux_remplissage)!=null?f(i.taux_remplissage):""),fontSize:18},children:s?"...":(i==null?void 0:i.taux_remplissage)!=null?f(i.taux_remplissage):""})]})]}),e.jsxs("div",{style:{marginBottom:16,display:"flex",alignItems:"center",justifyContent:"space-between",gap:16},children:[e.jsxs("div",{children:[e.jsx("div",{style:{fontSize:13,color:"#3A3163",fontWeight:500},children:"YTD"}),e.jsx("div",{style:{fontSize:20,fontWeight:700,color:"#000000"},children:s?"Chargement...":(i==null?void 0:i.ytd_ca)!=null?p(i.ytd_ca):p(0)})]}),e.jsxs("div",{style:{textAlign:"right"},children:[e.jsx("div",{style:{fontSize:13,color:"#3A3163",fontWeight:500},children:"Taux de croissance"}),e.jsx("span",{style:{...M((i==null?void 0:i.ytd_evolution)!=null?f(i.ytd_evolution):f(0)),fontSize:18},children:s?"...":(i==null?void 0:i.ytd_evolution)!=null?f(i.ytd_evolution):f(0)})]})]}),e.jsxs("div",{style:{marginBottom:16,display:"flex",alignItems:"center",justifyContent:"space-between",gap:16},children:[e.jsxs("div",{children:[e.jsxs("div",{style:{fontSize:13,color:"#3A3163",fontWeight:500},children:["YTM-1 ",u()]}),e.jsx("div",{style:{fontSize:20,fontWeight:700,color:"#000000"},children:s?"Chargement...":(i==null?void 0:i.ca_mois_precedent)!=null?p(i.ca_mois_precedent):p(0)})]}),e.jsxs("div",{style:{textAlign:"right"},children:[e.jsx("div",{style:{fontSize:13,color:"#3A3163",fontWeight:500},children:"Taux de croissance"}),e.jsx("span",{style:{...M((i==null?void 0:i.evolution_mois_precedent)!=null?f(i.evolution_mois_precedent):""),fontSize:18},children:s?"...":(i==null?void 0:i.evolution_mois_precedent)!=null?f(i.evolution_mois_precedent):""})]})]})]}),e.jsxs(E,{styles:{body:{padding:24,background:"#fff",cursor:"pointer"},header:{background:"#253338",borderRadius:"12px 12px 0 0",padding:0}},style:{borderRadius:12,boxShadow:"0 2px 8px #e5e7eb",border:"1px solid #e5e7eb",minWidth:260,maxWidth:320,flex:1},title:e.jsx("div",{style:{display:"flex",flexDirection:"column",alignItems:"center",gap:2,width:"100%"},children:e.jsxs("span",{style:{fontSize:22,color:"#ffffffff",fontWeight:700,display:"flex",alignItems:"center",gap:8,justifyContent:"center"},children:[e.jsx("img",{src:pe,alt:"Non Vie Icon",style:{width:28,height:28,objectFit:"contain",verticalAlign:"middle"}})," Non Vie"]})}),onClick:()=>l(c==="non-vie"?null:"non-vie"),children:[e.jsxs("div",{style:{marginBottom:16},children:[e.jsxs("div",{style:{fontSize:13,color:"#64748b",fontWeight:500},children:["CA du ",N()]}),e.jsx("div",{style:{fontSize:22,fontWeight:700,color:"#0f172a"},children:s?"Chargement...":(t==null?void 0:t.ca_du_jour)!=null?p(t.ca_du_jour):p(0)})]}),e.jsxs("div",{style:{marginBottom:16,display:"flex",alignItems:"center",justifyContent:"space-between",gap:16},children:[e.jsxs("div",{children:[e.jsx("div",{style:{fontSize:13,color:"#64748b",fontWeight:500},children:"MTD"}),e.jsx("div",{style:{fontSize:20,fontWeight:700,color:"#0f172a"},children:s?"Chargement...":(t==null?void 0:t.ca_mois_actuel)!=null?p(t.ca_mois_actuel):p(0)})]}),e.jsxs("div",{style:{textAlign:"right"},children:[e.jsx("div",{style:{fontSize:13,color:"#64748b",fontWeight:500},children:"Taux de remplissage"}),e.jsx("span",{style:{...A((t==null?void 0:t.taux_remplissage)!=null?f(t.taux_remplissage):""),fontSize:18},children:s?"Chargement...":(t==null?void 0:t.taux_remplissage)!=null?f(t.taux_remplissage):""})]})]}),e.jsxs("div",{style:{marginBottom:16,display:"flex",alignItems:"center",justifyContent:"space-between",gap:16},children:[e.jsxs("div",{children:[e.jsx("div",{style:{fontSize:13,color:"#64748b",fontWeight:500},children:"YTD"}),e.jsx("div",{style:{fontSize:20,fontWeight:700,color:"#0f172a"},children:s?"Chargement...":(t==null?void 0:t.ytd_ca)!=null?p(t.ytd_ca):p(0)})]}),e.jsxs("div",{style:{textAlign:"right"},children:[e.jsx("div",{style:{fontSize:13,color:"#64748b",fontWeight:500},children:"Taux de croissance"}),e.jsx("span",{style:{...A((t==null?void 0:t.ytd_evolution)!=null?f(t.ytd_evolution):f(0)),fontSize:18},children:s?"Chargement...":(t==null?void 0:t.ytd_evolution)!=null?f(t.ytd_evolution):f(0)})]})]}),e.jsxs("div",{style:{marginBottom:16,display:"flex",alignItems:"center",justifyContent:"space-between",gap:16},children:[e.jsxs("div",{children:[e.jsxs("div",{style:{fontSize:13,color:"#64748b",fontWeight:500},children:["YTM-1 ",u()]}),e.jsx("div",{style:{fontSize:20,fontWeight:700,color:"#0f172a"},children:s?"Chargement...":(t==null?void 0:t.ca_mois_precedent)!=null?p(t.ca_mois_precedent):p(0)})]}),e.jsxs("div",{style:{textAlign:"right"},children:[e.jsx("div",{style:{fontSize:13,color:"#64748b",fontWeight:500},children:"Taux de croissance"}),e.jsx("span",{style:{...A((t==null?void 0:t.evolution_mois_precedent)!=null?f(t.evolution_mois_precedent):""),fontSize:18},children:s?"...":(t==null?void 0:t.evolution_mois_precedent)!=null?f(t.evolution_mois_precedent):""})]})]})]}),e.jsxs(E,{styles:{body:{padding:24,background:"#fff",cursor:"pointer"},header:{background:"#253338",borderRadius:"12px 12px 0 0",padding:0}},style:{borderRadius:12,boxShadow:"0 2px 8px #e5e7eb",border:"1px solid #e5e7eb",minWidth:260,maxWidth:320,flex:1},title:e.jsx("div",{style:{display:"flex",flexDirection:"column",alignItems:"center",gap:2,width:"100%"},children:e.jsxs("span",{style:{fontSize:22,color:"#ffffffff",fontWeight:700,display:"flex",alignItems:"center",gap:8,justifyContent:"center"},children:[e.jsx("img",{src:xe,alt:"Vie Icon",style:{width:28,height:28,objectFit:"contain",verticalAlign:"middle"}})," Vie"]})}),onClick:()=>l(c==="vie"?null:"vie"),children:[e.jsxs("div",{style:{marginBottom:16},children:[e.jsxs("div",{style:{fontSize:13,color:"#64748b",fontWeight:500},children:["CA du ",N()]}),e.jsx("div",{style:{fontSize:22,fontWeight:700,color:"#0f172a"},children:s?"Chargement...":(n==null?void 0:n.ca_du_jour)!=null?p(n.ca_du_jour):p(0)})]}),e.jsxs("div",{style:{marginBottom:16,display:"flex",alignItems:"center",justifyContent:"space-between",gap:16},children:[e.jsxs("div",{children:[e.jsx("div",{style:{fontSize:13,color:"#64748b",fontWeight:500},children:"MTD"}),e.jsx("div",{style:{fontSize:20,fontWeight:700,color:"#0f172a"},children:s?"Chargement...":(n==null?void 0:n.ca_mois_actuel)!=null?p(n.ca_mois_actuel):p(0)})]}),e.jsxs("div",{style:{textAlign:"right"},children:[e.jsx("div",{style:{fontSize:13,color:"#64748b",fontWeight:500},children:"Taux de remplissage"}),e.jsx("span",{style:{...A((n==null?void 0:n.taux_remplissage)!=null?f(n.taux_remplissage):""),fontSize:18},children:s?"Chargement...":(n==null?void 0:n.taux_remplissage)!=null?f(n.taux_remplissage):""})]})]}),e.jsxs("div",{style:{marginBottom:16,display:"flex",alignItems:"center",justifyContent:"space-between",gap:16},children:[e.jsxs("div",{children:[e.jsx("div",{style:{fontSize:13,color:"#64748b",fontWeight:500},children:"YTD"}),e.jsx("div",{style:{fontSize:20,fontWeight:700,color:"#0f172a"},children:s?"Chargement...":(n==null?void 0:n.ytd_ca)!=null?p(n.ytd_ca):p(0)})]}),e.jsxs("div",{style:{textAlign:"right"},children:[e.jsx("div",{style:{fontSize:13,color:"#64748b",fontWeight:500},children:"Taux de croissance"}),e.jsx("span",{style:{...A((n==null?void 0:n.ytd_evolution)!=null?f(n.ytd_evolution):f(0)),fontSize:18},children:s?"Chargement...":(n==null?void 0:n.ytd_evolution)!=null?f(n.ytd_evolution):f(0)})]})]}),e.jsxs("div",{style:{marginBottom:16,display:"flex",alignItems:"center",justifyContent:"space-between",gap:16},children:[e.jsxs("div",{children:[e.jsxs("div",{style:{fontSize:13,color:"#64748b",fontWeight:500},children:["YTM-1 ",u()]}),e.jsx("div",{style:{fontSize:20,fontWeight:700,color:"#0f172a"},children:s?"Chargement...":(n==null?void 0:n.ca_mois_precedent)!=null?p(n.ca_mois_precedent):p(0)})]}),e.jsxs("div",{style:{textAlign:"right"},children:[e.jsx("div",{style:{fontSize:13,color:"#64748b",fontWeight:500},children:"Taux de croissance"}),e.jsx("span",{style:{...A((n==null?void 0:n.evolution_mois_precedent)!=null?f(n.evolution_mois_precedent):""),fontSize:18},children:s?"...":(n==null?void 0:n.evolution_mois_precedent)!=null?f(n.evolution_mois_precedent):""})]})]})]}),e.jsx(E,{styles:{body:{padding:24,background:"#fff",cursor:"pointer"},header:{background:"#253338",borderRadius:"12px 12px 0 0",padding:0}},style:{borderRadius:12,boxShadow:"0 2px 8px #e5e7eb",border:"1px solid #e5e7eb",minWidth:260,maxWidth:320,flex:1},title:e.jsx("div",{style:{display:"flex",flexDirection:"column",alignItems:"center",gap:2,width:"100%"},children:e.jsxs("span",{style:{fontSize:20,color:"#ffffffff",fontWeight:700,display:"flex",alignItems:"center",gap:8,justifyContent:"center"},children:[e.jsx("img",{src:ge,alt:"CA par BU à M-1 Icon",style:{width:28,height:28,objectFit:"contain",verticalAlign:"middle"}})," CA par BU Non Vie M-1"]})}),children:z?e.jsx("div",{style:{fontSize:16,color:"#64748b",textAlign:"center"},children:"Chargement..."}):e.jsx("div",{children:a.length===0?e.jsx("div",{style:{fontSize:14,color:"#64748b",textAlign:"center"},children:"Aucune donnée disponible"}):["MAMDA_HORS_MRC","MCMA_DIRECT","MAEM","COURTAGE"].map(g=>{const r=a.find(U=>U.bu===g);if(!r)return null;const C=p(r.ca_total_annee_courante),B=f(r.taux_total);let T=r.bu;return T==="MAMDA_HORS_MRC"&&(T="MAMDA"),T==="MCMA_DIRECT"&&(T="MCMA"),e.jsx("div",{style:{marginBottom:16},children:e.jsxs("div",{style:{display:"flex",alignItems:"center",justifyContent:"space-between"},children:[e.jsxs("div",{children:[e.jsx("div",{style:{fontSize:13,color:"#64748b",fontWeight:500},children:T}),e.jsx("div",{style:{fontSize:20,fontWeight:700,color:"#0f172a"},children:C})]}),e.jsxs("div",{style:{textAlign:"right"},children:[e.jsx("div",{style:{fontSize:13,color:"#64748b",fontWeight:500},children:"Taux de croissance"}),e.jsx("span",{style:{...A(B),fontSize:18},children:B})]})]})},g)})})})]}),S&&e.jsxs("div",{style:{background:"#fef2f2",border:"1px solid #fecaca",borderRadius:"8px",padding:"16px",margin:"16px auto",maxWidth:"600px",textAlign:"center"},children:[e.jsx("div",{style:{color:"#dc2626",fontWeight:600,marginBottom:"8px"},children:"⚠️ Erreur de connexion à la base de données"}),e.jsxs("div",{style:{color:"#7f1d1d",fontSize:"14px"},children:[S,". Impossible de récupérer les données depuis la base de données."]})]})]})}const{Sider:at}=G;function ye({selectedKey:c,onSelect:l,onLogout:m}){const[b,s]=j.useState(!1);return e.jsxs(e.Fragment,{children:[e.jsx("button",{className:"fixed top-4 left-4 z-50 bg-white rounded-lg shadow-md p-3 hover:bg-gray-50 transition-colors",onClick:()=>s(!0),children:e.jsx(se,{style:{fontSize:20,color:"#374151"}})}),e.jsx(H,{placement:"left",open:b,onClose:()=>s(!1),width:240,styles:{body:{padding:0}},headerStyle:{display:"none"},mask:!1,closable:!1,children:e.jsxs("div",{className:"flex flex-col h-full bg-white/98 backdrop-blur-sm border-r border-gray-200 shadow-lg",children:[e.jsxs("div",{className:"flex items-center justify-between p-4 border-b border-gray-100 bg-blue-50/95",children:[e.jsx("span",{className:"text-xl font-bold text-blue-700",children:"Flash Info"}),e.jsx("button",{onClick:()=>s(!1),className:"p-2 hover:bg-blue-100 rounded-full transition-colors",children:e.jsx(ne,{style:{fontSize:16,color:"#1d4ed8"}})})]}),e.jsx("div",{className:"flex-1 py-4",children:e.jsx(K,{mode:"inline",selectedKeys:[c],onClick:({key:h})=>{l(h)},className:"border-r-0",style:{backgroundColor:"transparent",fontSize:"13px"},items:[{key:"flash-info",icon:e.jsx(ie,{style:{color:"#3b82f6"}}),label:e.jsx("span",{className:"font-medium",children:"Flash Info"})},{key:"settings",icon:e.jsx(re,{style:{color:"#3b82f6"}}),label:e.jsx("span",{className:"font-medium",children:"Settings"})}]})}),e.jsx("div",{className:"border-t border-gray-100 p-4",children:e.jsx(R,{type:"primary",danger:!0,block:!0,icon:e.jsx(oe,{}),onClick:()=>{s(!1),m&&m()},className:"font-medium",children:"Déconnexion"})})]})})]})}const be="/assets/resetPasswordIcon-B-tdzR8m.png",ve=({onBack:c,onPasswordChanged:l})=>{const[m]=k.useForm(),[b,s]=j.useState(!1),[h,S]=j.useState(!1),[w,a]=j.useState(""),[_,z]=j.useState(""),[x,N]=j.useState(""),[v,u]=j.useState({score:0,label:"",color:""});j.useEffect(()=>{const d=localStorage.getItem("flashinfo_userLogin")||localStorage.getItem("flashinfo_username");d?N(d):a("Utilisateur non identifié. Veuillez vous reconnecter.")},[]);const I=d=>{if(!d)return{score:0,label:"",color:""};let t=0;d.length>=9&&(t+=1),/[a-z]/.test(d)&&(t+=1),/[A-Z]/.test(d)&&(t+=1),/[!@#$%^&*()_+\-=\[\]{};':"\\|,.<>\/?]/.test(d)&&(t+=1);let n="",i="";return t<=2?(n="Faible",i="red"):t===3?(n="Moyen",i="orange"):t===4&&(n="Fort",i="green"),{score:t*25,label:n,color:i}},y=d=>{const t=d.target.value;u(I(t))};j.useEffect(()=>{x&&fetch(`/api/users/checkPasswordChanged?username=${x}`).then(d=>d.json()).then(d=>{s(d.passwordChanged)}).catch(d=>{console.error("Error checking password status",d)})},[x]);const o=async d=>{if(!x){a("Utilisateur non identifié.");return}if(a(""),z(""),S(!0),d.newPassword!==d.confirmPassword){a("Les mots de passe ne correspondent pas"),S(!1);return}try{await de(x,d.newPassword),z("Mot de passe modifié avec succès !"),s(!0),l&&l()}catch(t){a("Échec du changement de mot de passe. Veuillez réessayer."),console.error("Erreur update password:",t)}finally{S(!1)}};return b?e.jsx("div",{className:"min-h-screen flex items-center justify-center bg-gray-50 dark:bg-gray-900",children:e.jsx(W,{message:"Votre mot de passe a déjà été modifié.",description:"Vous pouvez maintenant vous connecter avec votre nouveau mot de passe.",type:"success",showIcon:!0,className:"max-w-md"})}):x?e.jsx("div",{className:"change-password-container min-h-screen bg-gray-50 dark:bg-gray-900 flex items-center justify-center p-4",children:e.jsxs("div",{className:"change-password-card max-w-5xl w-full bg-white dark:bg-gray-800 rounded-2xl shadow-2xl overflow-hidden flex flex-col md:flex-row min-h-[600px]",children:[e.jsxs("div",{className:"hidden md:block md:w-1/2 bg-gradient-to-br from-purple-600 to-indigo-700 relative overflow-hidden",children:[e.jsx("div",{className:"absolute inset-0 bg-black opacity-10"}),e.jsxs("div",{className:"relative z-10 flex flex-col items-center justify-center h-full text-white px-12",children:[e.jsxs("div",{className:"relative mb-8",children:[e.jsx("div",{className:"w-32 h-32 rounded-full border-2 border-white/20 flex items-center justify-center relative z-10 bg-white/10 backdrop-blur-sm shadow-inner",children:e.jsx("img",{src:be,alt:"Réinitialisation du mot de passe",className:"w-20 h-20 object-contain"})}),e.jsx("div",{className:"absolute inset-0 w-32 h-32 rounded-full bg-purple-400 opacity-30 blur-2xl animate-pulse"})]}),e.jsx("h2",{className:"text-3xl font-bold mb-4 text-center",children:"Réinitialisation Sécurisée"}),e.jsx("p",{className:"text-center text-purple-100 mb-10 max-w-sm",children:"Choisissez un nouveau mot de passe fort pour protéger votre accès au tableau de bord FlashInfo."}),e.jsxs("div",{className:"space-y-4 text-left",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("span",{className:"text-green-300 text-xl",children:"✓"}),e.jsx("span",{children:"Minimum 9 caractères"})]}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("span",{className:"text-green-300 text-xl",children:"✓"}),e.jsx("span",{children:"Caractères spéciaux requis"})]}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("span",{className:"text-green-300 text-xl",children:"✓"}),e.jsx("span",{children:"Mélange de majuscules et minuscules"})]})]}),e.jsx("div",{className:"absolute bottom-8 left-8 text-white/60 text-sm",children:"MAMDA • MCMA"})]})]}),e.jsx("div",{className:"w-full md:w-1/2 p-8 md:p-16 flex flex-col justify-center",children:e.jsxs("div",{className:"max-w-md mx-auto w-full",children:[e.jsx("h1",{className:"text-3xl font-bold mb-2 bg-gradient-to-r from-purple-600 to-indigo-600 bg-clip-text text-transparent",children:"Nouveau mot de passe"}),e.jsxs("p",{className:"text-gray-600 dark:text-gray-400 mb-8",children:["Veuillez définir votre nouveau mot de passe pour le compte associé à ",e.jsx("strong",{children:x})]}),w&&e.jsx(W,{message:w,type:"error",showIcon:!0,closable:!0,className:"mb-6"}),_&&e.jsx(W,{message:_,type:"success",showIcon:!0,className:"mb-6"}),e.jsxs(k,{form:m,onFinish:o,layout:"vertical",className:"space-y-6",children:[e.jsx(k.Item,{name:"newPassword",label:"Nouveau mot de passe",rules:[{required:!0,message:"Veuillez saisir votre nouveau mot de passe"},{min:9,message:"Minimum 9 caractères"},{pattern:/[a-z]/,message:"Doit contenir au moins une minuscule"},{pattern:/[A-Z]/,message:"Doit contenir au moins une majuscule"},{pattern:/[!@#$%^&*()_+\-=\[\]{};':"\\|,.<>\/?]/,message:"Doit contenir au moins un caractère spécial (@, /, ?, !, etc.)"}],validateTrigger:"onSubmit",children:e.jsx(L.Password,{placeholder:"•••••••••",size:"large",className:"rounded-lg",onChange:y})}),v.label&&e.jsxs("div",{className:"mb-4",children:[e.jsxs("div",{className:"flex justify-between text-sm mb-1",children:[e.jsx("span",{children:"Force du mot de passe:"}),e.jsx("span",{style:{color:v.color,fontWeight:"bold"},children:v.label})]}),e.jsx(J,{percent:v.score,showInfo:!1,strokeColor:v.color,trailColor:"#e6e6e6"})]}),e.jsx(k.Item,{name:"confirmPassword",label:"Confirmer le mot de passe",dependencies:["newPassword"],rules:[{required:!0,message:"Veuillez confirmer votre mot de passe"},({getFieldValue:d})=>({validator(t,n){return!n||d("newPassword")===n?Promise.resolve():Promise.reject(new Error("Les deux mots de passe ne correspondent pas"))}})],children:e.jsx(L.Password,{placeholder:"•••••••••",size:"large",className:"rounded-lg"})}),e.jsx(k.Item,{children:e.jsx(R,{type:"primary",htmlType:"submit",size:"large",block:!0,loading:h,className:"bg-gradient-to-r from-purple-600 to-teal-600 hover:from-purple-700 hover:to-teal-700 h-12 text-base font-medium",children:h?"Changement en cours...":"Changer le mot de passe"})})]}),e.jsx("p",{className:"text-center text-xs text-gray-500 mt-8",children:"Si vous n'avez pas demandé ce changement, contactez immédiatement le support."})]})})]})}):e.jsx("div",{className:"min-h-screen flex items-center justify-center bg-gray-50 dark:bg-gray-900",children:e.jsx(W,{message:"Session expirée",description:"Veuillez vous reconnecter.",type:"warning",showIcon:!0})})};function we(){const[c,l]=j.useState(!1),[m,b]=j.useState(!1),s=(a,_)=>{localStorage.setItem("flashinfo_token",a),_==="0"||_===0?b(!0):l(!0)},h=()=>{b(!1)},S=()=>{b(!1),l(!0)},w=()=>{localStorage.clear(),l(!1),b(!1)};return e.jsxs("div",{className:"min-h-screen bg-background-light text-zinc-800",children:[!c&&!m&&e.jsxs("div",{className:"flex items-center justify-center min-h-screen",children:[e.jsx(he,{onLogin:s})," "]}),m&&e.jsx("div",{className:"flex items-center justify-center min-h-screen bg-gray-50 dark:bg-gray-900",children:e.jsx(ve,{onBack:h,onPasswordChanged:S})}),c&&e.jsxs("div",{className:"flex",children:[e.jsx(ye,{onLogout:w}),e.jsx("div",{className:"flex-1 lg:ml-56",children:e.jsx(je,{})})]})]})}Y.createRoot(document.getElementById("root")).render(e.jsx(V.StrictMode,{children:e.jsx(we,{})}));
